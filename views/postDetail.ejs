<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Gaming Sphere</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick.css" integrity="sha512-wR4oNhLBHf7smjy0K4oqzdWumd+r5/+6QO/vDda76MW5iug4PT7v86FoEkySIJft3XA0Ae6axhIvHrqwm793Nw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick-theme.css" integrity="sha512-6lLUdeQ5uheMFbWm3CP271l14RsX1xtx+J5x2yeIDkkiBpeVTNhTqijME7GgRKKi6hCqovwCoBTlRBEC20M8Mg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="/post.css">
    <link rel="stylesheet" href="https://cdn.ckeditor.com/ckeditor5/42.0.0/ckeditor5.css" />
  <body>
    <div>
    <nav class="navbar sticky-top navbar-expand-lg bg-body-tertiary ">
        <div class="container-fluid">
              <a class="navbar-brand" href="/home">
                <img src="/Img/logo.png" alt="Game_Sphere" width="160" height="50">
              </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0 nav-underline">
                <li class="nav-item">
                    <a class="nav-link" href="/home">
                      <img src="/Img/house.svg" alt="home_icon" width="20" height="20" class="d-inline-block ">
                      Home
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link-active" href="/forum">
                      <img src="/Img/chat-left.svg" alt="Bootstrap" width="20" height="20" class="d-inline-block ">
                      Forums
                    </a>
                </li>
              
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Whats New
                  </a>
                  <ul class="dropdown-menu">
                      <li class="nav-item">
                          <a class="dropdown-item" href="/trending">
                            <img src="/Img/graph-up-arrow.svg" alt="Bootstrap" width="20" height="20" class="d-inline-block ">
                            Trending Posts
                          </a>
                      </li>
                    <li><hr class="dropdown-divider"></li>
                    <li class="nav-item">
                      <a class="dropdown-item" href="/latest">
                        <img src="/Img/lightbulb.svg" alt="Bootstrap" width="20" height="20" class="d-inline-block ">
                        Latest Posts
                      </a>
                    </li>
                  </ul>
                </li>
              <% if (loggedin) { %>
                <li class="nav-item">
                  <a class="nav-link" href="/profile">
                    <i class="fas fa-user" aria-hidden="true"></i> Profile
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/logout" id="logoutButton">
                    <i class="fas fa-sign-out-alt" aria-hidden="true"></i> Logout
                  </a>
                </li>
              <% } %>
              <% if (!loggedin) { %>
                <li class="nav-item">
                  <a class="nav-link" href="/login" id="loginButton">
                    <img src="/Img/key.svg" alt="Log_In" width="20" height="20" class="d-inline-block ">
                    Login
                  </a>
                </li>
                <li class="nav-item" id="registerButton">
                  <a class="nav-link" href="#">
                    <img src="/Img/pencil-square.svg" alt="Register" width="20" height="20" class="d-inline-block ">
                    Register
                  </a>
                </li>
              <% } %>
            </ul>
            <form class="d-flex" role="search" method="POST" action="/search">
              <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
              <button class="btn btn-outline-success" type="submit">Search</button>
            </form>
          </div>
        </div>
      </nav>
    </div>
    
    <div class="container mt-4">
      <div class="row">
          <div class="col-md-12">
              <h1 class="display-6"><%= post.title %></h1>
              <ul class="post-details-horizontal">
                  <li><i class="fas fa-user"></i> <%= username %></li>
                  <li> <i class="fas fa-clock"></i> <%= new Date(post.postdate).toLocaleDateString() %></li>
                  <li> <%= post.category %></li>
              </ul>
          </div>
          <div class="col-md-12 post-box">
                <div class="user-icon" style="display: flex; flex-direction: column; justify-items: center; align-items: center;">
                <div class="profile-icon">
                <i class="fas fa-user-circle fa-2x"></i>
                </div>
                <p class="user_name"><%= username %></p>
                </div>
                <div class="post-content">
                  <div style="padding-bottom: 10px;">
                    <div class="main-container">
                      <div class="editor-container editor-container_classic-editor" id="editor-container">
                        <div class="editor-container__editor"><div id="editor"></div></div>
                      </div>
                    </div>
                  </div>
                <div style="text-align: right; padding-bottom: 10px;">
                  <button id="replyBtn" class="btn btn-secondary">Reply</button>
                </div>
                </div>
          </div>  
      </div>
    </div>

  <div class="container mt-4" id="replyForm" style="display: none;">
  <div class="row">
    <div class="col-md-12">
      <form action="/post/<%= post.postid %>/reply" method="POST">
        <div class="mb-3">
          <textarea class="form-control" id="replyContent" name="replyContent" rows="3" placeholder="Add a reply" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Submit Reply</button>
      </form>
    </div>
  </div>
  </div>
    <div class="container mt-4">
      <h3>Replies</h3>
      <ul class="replies-list">
        <% comments.forEach(function displayComment(comment) { %>
          <li>
              <div class="row">
                <div class="col-md-12 post-box">
                      <div class="user-icon-comment" style="display: flex; flex-direction: column; justify-items: center; align-items: center;">
                      <div class="profile-icon">
                      <i class="fas fa-user-circle fa-2x"></i>
                      </div>
                      <p class="user_name"><%= comment.user_name %></p>
                      </div>
                      <div class="post-content" style="display: flex; flex-direction: column; justify-content: space-between;">
                        <%= comment.content %>
                      <div style="text-align: right; padding-bottom: 10px;">
                        <button  id="repliesBtn-<%= comment.id %>" class="btn btn-secondary" onclick="toggleReplyForm(<%= comment.id %>)">Reply</button>  
                      </div>
                      </div>
                </div>  
              </div>
   
            <div class="container mt-4" id="repliesForm-<%= comment.id %>" style="display: none;">
              <div class="row">
                <div class="col-md-12">
                  <!-- Corrected form tag placement -->
                  <form action="/post/reply/<%= comment.id %>?post_id=<%= comment.post_id %>" method="POST">
                    <div class="mb-3">
                      <textarea class="form-control" id="replyContent-<%= comment.id %>" name="replyContent" rows="3" placeholder="Add a reply" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit Reply</button>
                  </form>
                </div>
              </div>
            </div>
            <% if (comment.children && comment.children.length > 0) { %>
              <ul class="replies-list">
                <% comment.children.forEach(displayComment); %>
              </ul>
            <% } %>
          </li>
        <% }); %>
      </ul>
    </div>

    <div style="padding-top: 20px;">
      <footer class="bg-dark text-center text-white ">
        <div class="container p-4 pb-0 ">
          <section class="mb-4">
            <!-- Facebook -->
            <a class="btn btn-outline-light btn-floating m-1" href="#!" role="button"
              ><i class="fab fa-facebook-f"></i
            ></a>
      
            <!-- Twitter -->
            <a class="btn btn-outline-light btn-floating m-1" href="#!" role="button"
              ><i class="fab fa-twitter"></i
            ></a>
      
            <!-- Instagram -->
            <a class="btn btn-outline-light btn-floating m-1" href="#!" role="button"
              ><i class="fab fa-instagram"></i
            ></a>
      
            <!-- Github -->
            <a class="btn btn-outline-light btn-floating m-1" href="#!" role="button"
              ><i class="fab fa-github"></i
            ></a>
          </section>
        </div>
         
        <!-- Contact Info -->
        <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
          <p>Contact Us:</p>
          <p>Email: contact@gamesphere.com</p>
          <p>Phone: +123 456 7890</p>
          <p>Address: 123 Gaming Blvd, Game City, GC 12345</p>
        </div>
  
        <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
          © 2023 Game Sphere:
          <a class="text-white" href="https://gamesphere.com/">gamesphere.com</a>
        </div>
      </footer>  
    </div> 

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-migrate/3.4.1/jquery-migrate.min.js" integrity="sha512-KgffulL3mxrOsDicgQWA11O6q6oKeWcV00VxgfJw4TcM8XRQT8Df9EsrYxDf7tpVpfl3qcYD96BpyPvA4d1FDQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick.min.js" integrity="sha512-HGOnQO9+SP1V92SrtZfjqxxtLmVzqZpjFFekvzZVWoiASSQgSr4cw9Kqd2+l8Llp4Gm0G8GIFJ4ddwZilcdb8A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="importmap">
      {
          "imports": {
              "ckeditor5": "https://cdn.ckeditor.com/ckeditor5/42.0.0/ckeditor5.js",
              "ckeditor5/": "https://cdn.ckeditor.com/ckeditor5/42.0.0/"
          }
      }
    </script>
    <script>
      document.getElementById('replyBtn').addEventListener('click', function() {
    var replyForm = document.getElementById('replyForm');
    if (replyForm.style.display === 'none') {
      replyForm.style.display = 'block';
    } else {
      replyForm.style.display = 'none';
    }
  });
  function toggleReplyForm(commentId) {
    var formId = "repliesForm-" + commentId;
    var form = document.getElementById(formId);
    if (form.style.display === 'none') {
      form.style.display = 'block';
    } else {
      form.style.display = 'none';
    }
  } 
    </script>
    <script type="module">
import {
    ClassicEditor,
    AccessibilityHelp,
    Alignment,
    Autoformat,
    AutoImage,
    AutoLink,
    Autosave,
    Base64UploadAdapter,
    BlockQuote,
    Bold,
    Code,
    CodeBlock,
    Essentials,
    FindAndReplace,
    FontBackgroundColor,
    FontColor,
    FontFamily,
    FontSize,
    FullPage,
    GeneralHtmlSupport,
    Heading,
    Highlight,
    HorizontalLine,
    HtmlComment,
    HtmlEmbed,
    ImageBlock,
    ImageCaption,
    ImageInline,
    ImageInsert,
    ImageInsertViaUrl,
    ImageResize,
    ImageStyle,
    ImageTextAlternative,
    ImageToolbar,
    ImageUpload,
    Indent,
    IndentBlock,
    Italic,
    Link,
    LinkImage,
    List,
    ListProperties,
    Paragraph,
    SelectAll,
    ShowBlocks,
    SourceEditing,
    SpecialCharacters,
    Strikethrough,
    Table,
    TableCaption,
    TableCellProperties,
    TableColumnResize,
    TableProperties,
    TableToolbar,
    TextTransformation,
    Underline,
    Undo
  } from 'ckeditor5';
  const postContent = `<%- post.content %>`;
  const editorConfig = {
    toolbar: {
      items: [
        'undo',
        'redo',
        '|',
        'sourceEditing',
        'showBlocks',
        '|',
        'heading',
        '|',
        'fontSize',
        'fontFamily',
        'fontColor',
        'fontBackgroundColor',
        '|',
        'bold',
        'italic',
        'underline',
        '|',
        'link',
        'insertImage',
        'insertTable',
        'highlight',
        'blockQuote',
        'codeBlock',
        '|',
        'alignment',
        '|',
        'bulletedList',
        'numberedList',
        'indent',
        'outdent'
      ],
      shouldNotGroupWhenFull: false
    },
    plugins: [
      AccessibilityHelp,
      Alignment,
      Autoformat,
      AutoImage,
      AutoLink,
      Autosave,
      Base64UploadAdapter,
      BlockQuote,
      Bold,
      Code,
      CodeBlock,
      Essentials,
      FindAndReplace,
      FontBackgroundColor,
      FontColor,
      FontFamily,
      FontSize,
      FullPage,
      GeneralHtmlSupport,
      Heading,
      Highlight,
      HorizontalLine,
      HtmlComment,
      HtmlEmbed,
      ImageBlock,
      ImageCaption,
      ImageInline,
      ImageInsert,
      ImageInsertViaUrl,
      ImageResize,
      ImageStyle,
      ImageTextAlternative,
      ImageToolbar,
      ImageUpload,
      Indent,
      IndentBlock,
      Italic,
      Link,
      LinkImage,
      List,
      ListProperties,
      Paragraph,
      SelectAll,
      ShowBlocks,
      SourceEditing,
      SpecialCharacters,
      Strikethrough,
      Table,
      TableCaption,
      TableCellProperties,
      TableColumnResize,
      TableProperties,
      TableToolbar,
      TextTransformation,
      Underline,
      Undo
    ],
    fontFamily: {
      supportAllValues: true
    },
    fontSize: {
      options: [10, 12, 14, 'default', 18, 20, 22],
      supportAllValues: true
    },
    heading: {
      options: [
        {
          model: 'paragraph',
          title: 'Paragraph',
          class: 'ck-heading_paragraph'
        },
        {
          model: 'heading1',
          view: 'h1',
          title: 'Heading 1',
          class: 'ck-heading_heading1'
        },
        {
          model: 'heading2',
          view: 'h2',
          title: 'Heading 2',
          class: 'ck-heading_heading2'
        },
        {
          model: 'heading3',
          view: 'h3',
          title: 'Heading 3',
          class: 'ck-heading_heading3'
        },
        {
          model: 'heading4',
          view: 'h4',
          title: 'Heading 4',
          class: 'ck-heading_heading4'
        },
        {
          model: 'heading5',
          view: 'h5',
          title: 'Heading 5',
          class: 'ck-heading_heading5'
        },
        {
          model: 'heading6',
          view: 'h6',
          title: 'Heading 6',
          class: 'ck-heading_heading6'
        }
      ]
    },
    htmlSupport: {
      allow: [
        {
          name: /^.*$/,
          styles: true,
          attributes: true,
          classes: true
        }
      ]
    },
    image: {
      toolbar: [
        'toggleImageCaption',
        'imageTextAlternative',
        '|',
        'imageStyle:inline',
        'imageStyle:wrapText',
        'imageStyle:breakText',
        '|',
        'resizeImage'
      ]
    },
    link: {
      addTargetToExternalLinks: true,
      defaultProtocol: 'https://',
      decorators: {
        toggleDownloadable: {
          mode: 'manual',
          label: 'Downloadable',
          attributes: {
            download: 'file'
          }
        }
      }
    },
    list: {
      properties: {
        styles: true,
        startIndex: true,
        reversed: true
      }
    },
    menuBar: {
      isVisible: false
    },
    placeholder: 'Type or paste your content here!',
    table: {
      contentToolbar: ['tableColumn', 'tableRow', 'mergeTableCells', 'tableProperties', 'tableCellProperties']
    },
    lockId : 'readonly',
    initialData: postContent,
  };

  ClassicEditor.create(document.querySelector('#editor'), editorConfig).then(editor => {
      console.log('hi');
      const toolbarElement = editor.ui.view.toolbar.element;
      toolbarElement.style.display = 'none';
      editor.enableReadOnlyMode( 'readonly' );
  })
  .catch(error => {
    console.error(error);
  });
    
    </script>
  </body>
</html>